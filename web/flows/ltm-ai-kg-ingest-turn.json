{
  "id": "ltm-ai-kg-ingest-turn",
  "name": "ltm-ai-kg-ingest-turn",
  "description": "Extract triples from a turn (or any text fragment) and assert them into AbstractMemory via the runtime-owned memory_kg_assert effect. Designed to be composed into ltm-ai-chat or scheduled maintenance workflows.",
  "interfaces": [],
  "nodes": [
    {
      "id": "node-1",
      "type": "on_flow_start",
      "position": {
        "x": 96.0,
        "y": 128.0
      },
      "data": {
        "nodeType": "on_flow_start",
        "label": "Start",
        "icon": "&#x1F3C1;",
        "headerColor": "#C0392B",
        "inputs": [],
        "outputs": [
          {
            "id": "exec-out",
            "label": "",
            "type": "execution"
          },
          {
            "id": "provider",
            "label": "provider",
            "type": "provider"
          },
          {
            "id": "model",
            "label": "model",
            "type": "model"
          },
          {
            "id": "text",
            "label": "text",
            "type": "string"
          },
          {
            "id": "scope",
            "label": "scope",
            "type": "string"
          },
          {
            "id": "span_id",
            "label": "span_id",
            "type": "string"
          },
          {
            "id": "domain_focus",
            "label": "domain_focus",
            "type": "string"
          },
          {
            "id": "max_out_tokens",
            "label": "max_out_tokens",
            "type": "number"
          }
        ],
        "pinDefaults": {
          "provider": "lmstudio",
          "model": "qwen/qwen3-next-80b",
          "scope": "session",
          "domain_focus": "software / agents / memory systems",
          "max_out_tokens": 900
        }
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-2",
      "type": "literal_json",
      "position": {
        "x": 96.0,
        "y": 336.0
      },
      "data": {
        "nodeType": "literal_json",
        "label": "Subflow input",
        "icon": "{}",
        "headerColor": "#00FFFF",
        "inputs": [],
        "outputs": [
          {
            "id": "value",
            "label": "value",
            "type": "object"
          }
        ],
        "literalValue": {}
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-3",
      "type": "set",
      "position": {
        "x": 320.0,
        "y": 288.0
      },
      "data": {
        "nodeType": "set",
        "label": "Set provider",
        "icon": "&#x1F4E4;",
        "headerColor": "#3498DB",
        "inputs": [
          {
            "id": "object",
            "label": "object",
            "type": "object"
          },
          {
            "id": "key",
            "label": "key",
            "type": "string"
          },
          {
            "id": "value",
            "label": "value",
            "type": "any"
          }
        ],
        "outputs": [
          {
            "id": "result",
            "label": "result",
            "type": "object"
          }
        ],
        "pinDefaults": {
          "key": "provider"
        }
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-4",
      "type": "set",
      "position": {
        "x": 560.0,
        "y": 288.0
      },
      "data": {
        "nodeType": "set",
        "label": "Set model",
        "icon": "&#x1F4E4;",
        "headerColor": "#3498DB",
        "inputs": [
          {
            "id": "object",
            "label": "object",
            "type": "object"
          },
          {
            "id": "key",
            "label": "key",
            "type": "string"
          },
          {
            "id": "value",
            "label": "value",
            "type": "any"
          }
        ],
        "outputs": [
          {
            "id": "result",
            "label": "result",
            "type": "object"
          }
        ],
        "pinDefaults": {
          "key": "model"
        }
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-5",
      "type": "set",
      "position": {
        "x": 800.0,
        "y": 288.0
      },
      "data": {
        "nodeType": "set",
        "label": "Set text",
        "icon": "&#x1F4E4;",
        "headerColor": "#3498DB",
        "inputs": [
          {
            "id": "object",
            "label": "object",
            "type": "object"
          },
          {
            "id": "key",
            "label": "key",
            "type": "string"
          },
          {
            "id": "value",
            "label": "value",
            "type": "any"
          }
        ],
        "outputs": [
          {
            "id": "result",
            "label": "result",
            "type": "object"
          }
        ],
        "pinDefaults": {
          "key": "text"
        }
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-6",
      "type": "set",
      "position": {
        "x": 1040.0,
        "y": 288.0
      },
      "data": {
        "nodeType": "set",
        "label": "Set domain_focus",
        "icon": "&#x1F4E4;",
        "headerColor": "#3498DB",
        "inputs": [
          {
            "id": "object",
            "label": "object",
            "type": "object"
          },
          {
            "id": "key",
            "label": "key",
            "type": "string"
          },
          {
            "id": "value",
            "label": "value",
            "type": "any"
          }
        ],
        "outputs": [
          {
            "id": "result",
            "label": "result",
            "type": "object"
          }
        ],
        "pinDefaults": {
          "key": "domain_focus"
        }
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-11",
      "type": "set",
      "position": {
        "x": 1280.0,
        "y": 288.0
      },
      "data": {
        "nodeType": "set",
        "label": "Set max_out_tokens",
        "icon": "&#x1F4E4;",
        "headerColor": "#3498DB",
        "inputs": [
          {
            "id": "object",
            "label": "object",
            "type": "object"
          },
          {
            "id": "key",
            "label": "key",
            "type": "string"
          },
          {
            "id": "value",
            "label": "value",
            "type": "any"
          }
        ],
        "outputs": [
          {
            "id": "result",
            "label": "result",
            "type": "object"
          }
        ],
        "pinDefaults": {
          "key": "max_out_tokens"
        }
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-7",
      "type": "subflow",
      "position": {
        "x": 1280.0,
        "y": 128.0
      },
      "data": {
        "nodeType": "subflow",
        "label": "Extract triples",
        "icon": "&#x1F4E6;",
        "headerColor": "#00CCCC",
        "inputs": [
          {
            "id": "exec-in",
            "label": "",
            "type": "execution"
          },
          {
            "id": "inherit_context",
            "label": "inherit_context",
            "type": "boolean",
            "description": "When true, seed the child run's context.messages from the parent's active context messages. If the pin is not connected, the node checkbox is used. Default: false."
          },
          {
            "id": "input",
            "label": "input",
            "type": "object"
          }
        ],
        "outputs": [
          {
            "id": "exec-out",
            "label": "",
            "type": "execution"
          },
          {
            "id": "output",
            "label": "output",
            "type": "object"
          }
        ],
        "subflowId": "ltm-ai-kg-extract-triples",
        "pinDefaults": {
          "inherit_context": false
        }
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-8",
      "type": "get",
      "position": {
        "x": 1504.0,
        "y": 128.0
      },
      "data": {
        "nodeType": "get",
        "label": "Get assertions",
        "icon": "&#x1F4E5;",
        "headerColor": "#3498DB",
        "inputs": [
          {
            "id": "object",
            "label": "object",
            "type": "object"
          },
          {
            "id": "key",
            "label": "key",
            "type": "string"
          },
          {
            "id": "default",
            "label": "default",
            "type": "any"
          }
        ],
        "outputs": [
          {
            "id": "value",
            "label": "value",
            "type": "any"
          }
        ],
        "pinDefaults": {
          "key": "assertions",
          "default": []
        }
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-9",
      "type": "memory_kg_assert",
      "position": {
        "x": 1728.0,
        "y": 128.0
      },
      "data": {
        "nodeType": "memory_kg_assert",
        "label": "Assert triples",
        "icon": "&#x1F9E0;",
        "headerColor": "#8E44AD",
        "inputs": [
          {
            "id": "exec-in",
            "label": "",
            "type": "execution"
          },
	          {
	            "id": "assertions",
	            "label": "assertions",
	            "type": "assertions",
	            "description": "List of {subject,predicate,object,...} assertion objects."
	          },
          {
            "id": "scope",
            "label": "scope",
            "type": "string",
            "description": "run | session | global. Determines the owner_id when not explicitly provided."
          },
          {
            "id": "span_id",
            "label": "span_id",
            "type": "string",
            "description": "Optional provenance pointer to a runtime span/artifact id."
          },
          {
            "id": "owner_id",
            "label": "owner_id",
            "type": "string",
            "description": "Optional explicit owner id override (advanced; normally derived from scope)."
          }
        ],
        "outputs": [
          {
            "id": "exec-out",
            "label": "",
            "type": "execution"
          },
          {
            "id": "assertion_ids",
            "label": "assertion_ids",
            "type": "array",
            "description": "IDs assigned by the store (implementation-specific)."
          },
          {
            "id": "count",
            "label": "count",
            "type": "number",
            "description": "Number of asserted triples."
          },
          {
            "id": "ok",
            "label": "ok",
            "type": "boolean",
            "description": "True when assertion succeeded."
          },
          {
            "id": "raw",
            "label": "raw",
            "type": "object"
          }
        ]
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-12",
      "type": "length",
      "position": { "x": 1344.0, "y": 256.0 },
      "data": {
        "nodeType": "length",
        "label": "span_id len",
        "icon": "#",
        "headerColor": "#E74C3C",
        "inputs": [{ "id": "text", "label": "text", "type": "string" }],
        "outputs": [{ "id": "result", "label": "result", "type": "number" }]
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-13",
      "type": "compare",
      "position": { "x": 1520.0, "y": 256.0 },
      "data": {
        "nodeType": "compare",
        "label": "has span_id",
        "icon": "=?",
        "headerColor": "#F39C12",
        "inputs": [
          { "id": "a", "label": "a", "type": "any" },
          { "id": "op", "label": "op", "type": "string" },
          { "id": "b", "label": "b", "type": "any" }
        ],
        "outputs": [{ "id": "result", "label": "result", "type": "boolean" }],
        "pinDefaults": { "op": ">", "b": 0 }
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-14",
      "type": "if",
      "position": { "x": 1696.0, "y": 256.0 },
      "data": {
        "nodeType": "if",
        "label": "If span_id",
        "icon": "&#x2753;",
        "headerColor": "#F39C12",
        "inputs": [
          { "id": "exec-in", "label": "", "type": "execution" },
          { "id": "condition", "label": "condition", "type": "boolean" }
        ],
        "outputs": [
          { "id": "true", "label": "true", "type": "execution" },
          { "id": "false", "label": "false", "type": "execution" }
        ]
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-15",
      "type": "string_template",
      "position": { "x": 1520.0, "y": 384.0 },
      "data": {
        "nodeType": "string_template",
        "label": "Build source note",
        "icon": "&#x1F4DD;",
        "headerColor": "#3498DB",
        "inputs": [
          { "id": "template", "label": "template", "type": "string" },
          { "id": "vars", "label": "vars", "type": "object" }
        ],
        "outputs": [{ "id": "result", "label": "result", "type": "string" }],
        "pinDefaults": {
          "template": "# KG ingest-turn source\\n\\n(domain_focus={{domain_focus}})\\n\\n{{text}}"
        }
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-16",
      "type": "memory_note",
      "position": { "x": 1696.0, "y": 384.0 },
      "data": {
        "nodeType": "memory_note",
        "label": "Store source span",
        "icon": "&#x1F4DD;",
        "headerColor": "#2ECC71",
        "inputs": [
          { "id": "exec-in", "label": "", "type": "execution" },
          { "id": "keep_in_context", "label": "in_context", "type": "boolean" },
          { "id": "scope", "label": "scope", "type": "string" },
          { "id": "content", "label": "content", "type": "string" },
          { "id": "location", "label": "location", "type": "string" },
          { "id": "tags", "label": "tags", "type": "object" },
          { "id": "sources", "label": "sources", "type": "object" }
        ],
        "outputs": [
          { "id": "exec-out", "label": "", "type": "execution" },
          { "id": "note_id", "label": "note_id", "type": "string" }
        ],
        "pinDefaults": {
          "keep_in_context": false,
          "scope": "run",
          "location": "kg_ingest_turn_source",
          "tags": { "kind": "kg_ingest_turn_source" }
        }
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-17",
      "type": "coalesce",
      "position": { "x": 1520.0, "y": 512.0 },
      "data": {
        "nodeType": "coalesce",
        "label": "span_id (fallback note)",
        "icon": "&#x1F517;",
        "headerColor": "#3498DB",
        "inputs": [
          { "id": "a", "label": "span_id", "type": "any" },
          { "id": "b", "label": "fallback", "type": "any" }
        ],
        "outputs": [{ "id": "result", "label": "result", "type": "any" }]
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    },
    {
      "id": "node-10",
      "type": "on_flow_end",
      "position": {
        "x": 1952.0,
        "y": 128.0
      },
      "data": {
        "nodeType": "on_flow_end",
        "label": "End",
        "icon": "&#x23F9;",
        "headerColor": "#C0392B",
        "inputs": [
          {
            "id": "exec-in",
            "label": "",
            "type": "execution"
          },
          {
            "id": "extracted",
            "label": "extracted",
            "type": "object"
          },
          {
            "id": "assertion_ids",
            "label": "assertion_ids",
            "type": "array"
          },
          {
            "id": "count",
            "label": "count",
            "type": "number"
          },
          {
            "id": "ok",
            "label": "ok",
            "type": "boolean"
          }
        ],
        "outputs": []
      },
      "label": null,
      "icon": null,
      "headerColor": null,
      "inputs": [],
      "outputs": []
    }
  ],
  "edges": [
    {
      "id": "edge-1",
      "source": "node-2",
      "sourceHandle": "value",
      "target": "node-3",
      "targetHandle": "object",
      "animated": false
    },
    {
      "id": "edge-2",
      "source": "node-1",
      "sourceHandle": "provider",
      "target": "node-3",
      "targetHandle": "value",
      "animated": false
    },
    {
      "id": "edge-3",
      "source": "node-3",
      "sourceHandle": "result",
      "target": "node-4",
      "targetHandle": "object",
      "animated": false
    },
    {
      "id": "edge-4",
      "source": "node-1",
      "sourceHandle": "model",
      "target": "node-4",
      "targetHandle": "value",
      "animated": false
    },
    {
      "id": "edge-5",
      "source": "node-4",
      "sourceHandle": "result",
      "target": "node-5",
      "targetHandle": "object",
      "animated": false
    },
    {
      "id": "edge-6",
      "source": "node-1",
      "sourceHandle": "text",
      "target": "node-5",
      "targetHandle": "value",
      "animated": false
    },
    {
      "id": "edge-7",
      "source": "node-5",
      "sourceHandle": "result",
      "target": "node-6",
      "targetHandle": "object",
      "animated": false
    },
    {
      "id": "edge-8",
      "source": "node-1",
      "sourceHandle": "domain_focus",
      "target": "node-6",
      "targetHandle": "value",
      "animated": false
    },
    {
      "id": "edge-9",
      "source": "node-6",
      "sourceHandle": "result",
      "target": "node-11",
      "targetHandle": "object",
      "animated": false
    },
    {
      "id": "edge-9b",
      "source": "node-1",
      "sourceHandle": "max_out_tokens",
      "target": "node-11",
      "targetHandle": "value",
      "animated": false
    },
    {
      "id": "edge-9c",
      "source": "node-11",
      "sourceHandle": "result",
      "target": "node-7",
      "targetHandle": "input",
      "animated": false
    },
    {
      "id": "edge-10",
      "source": "node-1",
      "sourceHandle": "exec-out",
      "target": "node-7",
      "targetHandle": "exec-in",
      "animated": true
    },
    {
      "id": "edge-11",
      "source": "node-7",
      "sourceHandle": "output",
      "target": "node-8",
      "targetHandle": "object",
      "animated": false
    },
    {
      "id": "edge-12",
      "source": "node-8",
      "sourceHandle": "value",
      "target": "node-9",
      "targetHandle": "assertions",
      "animated": false
    },
    {
      "id": "edge-13",
      "source": "node-1",
      "sourceHandle": "scope",
      "target": "node-9",
      "targetHandle": "scope",
      "animated": false
    },
    {
      "id": "edge-14",
      "source": "node-1",
      "sourceHandle": "span_id",
      "target": "node-17",
      "targetHandle": "a",
      "animated": false
    },
    {
      "id": "edge-15",
      "source": "node-7",
      "sourceHandle": "exec-out",
      "target": "node-14",
      "targetHandle": "exec-in",
      "animated": true
    },
    {
      "id": "edge-21",
      "source": "node-1",
      "sourceHandle": "span_id",
      "target": "node-12",
      "targetHandle": "text",
      "animated": false
    },
    {
      "id": "edge-22",
      "source": "node-12",
      "sourceHandle": "result",
      "target": "node-13",
      "targetHandle": "a",
      "animated": false
    },
    {
      "id": "edge-23",
      "source": "node-13",
      "sourceHandle": "result",
      "target": "node-14",
      "targetHandle": "condition",
      "animated": false
    },
    {
      "id": "edge-24",
      "source": "node-14",
      "sourceHandle": "true",
      "target": "node-9",
      "targetHandle": "exec-in",
      "animated": true
    },
    {
      "id": "edge-25",
      "source": "node-14",
      "sourceHandle": "false",
      "target": "node-16",
      "targetHandle": "exec-in",
      "animated": true
    },
    {
      "id": "edge-26",
      "source": "node-16",
      "sourceHandle": "exec-out",
      "target": "node-9",
      "targetHandle": "exec-in",
      "animated": true
    },
    {
      "id": "edge-27",
      "source": "node-11",
      "sourceHandle": "result",
      "target": "node-15",
      "targetHandle": "vars",
      "animated": false
    },
    {
      "id": "edge-28",
      "source": "node-15",
      "sourceHandle": "result",
      "target": "node-16",
      "targetHandle": "content",
      "animated": false
    },
    {
      "id": "edge-29",
      "source": "node-16",
      "sourceHandle": "note_id",
      "target": "node-17",
      "targetHandle": "b",
      "animated": false
    },
    {
      "id": "edge-30",
      "source": "node-17",
      "sourceHandle": "result",
      "target": "node-9",
      "targetHandle": "span_id",
      "animated": false
    },
    {
      "id": "edge-16",
      "source": "node-7",
      "sourceHandle": "output",
      "target": "node-10",
      "targetHandle": "extracted",
      "animated": false
    },
    {
      "id": "edge-17",
      "source": "node-9",
      "sourceHandle": "assertion_ids",
      "target": "node-10",
      "targetHandle": "assertion_ids",
      "animated": false
    },
    {
      "id": "edge-18",
      "source": "node-9",
      "sourceHandle": "count",
      "target": "node-10",
      "targetHandle": "count",
      "animated": false
    },
    {
      "id": "edge-19",
      "source": "node-9",
      "sourceHandle": "ok",
      "target": "node-10",
      "targetHandle": "ok",
      "animated": false
    },
    {
      "id": "edge-20",
      "source": "node-9",
      "sourceHandle": "exec-out",
      "target": "node-10",
      "targetHandle": "exec-in",
      "animated": true
    }
  ],
  "entryNode": "node-1",
  "created_at": null,
  "updated_at": "2026-01-17T07:33:12.069302"
}
